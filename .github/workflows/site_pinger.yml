name: ğŸŒ Site Setup + Ping + Deploy

on:
  push:
    branches:
      - main
  schedule:
    - cron: "*/5 * * * *" # Runs every 5 minutes
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build-and-deploy:
    name: ğŸ› ï¸ Build & ğŸš€ Deploy
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup website files
        run: |
          mkdir -p website
          echo "<html><body><h1>WebOS Simulator Test</h1></body></html>" > website/index.html
          
      - name: Upload Pages Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './website'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

  loop_ping:
    name: ğŸ”„ Ping Website
    runs-on: ubuntu-latest
    needs: build-and-deploy # Wait until deployment is finished
    steps:
      - name: Ping live site
        run: |
          URL="https://luisdiko14-lab.github.io/WebOSSimulator-in-windows/"
          echo "Pinging $URL..."
          # Added -L to follow redirects and -s for silent output
          curl -IsL --max-time 15 "$URL" | grep "HTTP/" || echo "Ping failed"
